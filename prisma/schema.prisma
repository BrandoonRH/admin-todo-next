generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/**
 * ğŸ“ MODELO TODO
 * 
 * Tabla de ejemplo para las tareas/todos de cada usuario.
 * Cada todo pertenece a un Ãºnico usuario (relaciÃ³n many-to-one).
 */
model Todo {
  id          String   @id @default(uuid())  // ID Ãºnico del todo
  description String                         // DescripciÃ³n de la tarea
  complete    Boolean  @default(false)       // Estado: completado o pendiente
  createdAt   DateTime @default(now())       // Fecha de creaciÃ³n
  updatedAt   DateTime @updatedAt            // Fecha de Ãºltima actualizaciÃ³n (auto)
  userId      String                         // ID del usuario dueÃ±o del todo
  
  // RelaciÃ³n: cada todo pertenece a un usuario
  user   User   @relation(fields: [userId], references: [id])
}

// ============================================================================
// ğŸ” MODELOS DE NEXTAUTH (PRISMA ADAPTER)
// ============================================================================
// Los siguientes modelos son requeridos por NextAuth cuando usas Prisma Adapter.
// NextAuth los usa para gestionar autenticaciÃ³n OAuth, sesiones y usuarios.
// MÃ¡s info: https://authjs.dev/reference/adapter/prisma

/**
 * ğŸ‘¤ MODELO USER
 * 
 * Tabla principal de usuarios. NextAuth la usa para guardar informaciÃ³n
 * bÃ¡sica de todos los usuarios (OAuth y credenciales).
 * 
 * CAMPOS ESTÃNDAR DE NEXTAUTH:
 * - id, name, email, emailVerified, image
 * 
 * CAMPOS PERSONALIZADOS (agregados por ti):
 * - password: Para login con credenciales (email/password)
 * - roles: Array de roles del usuario (ej: ["user", "admin"])
 * - isActive: Control de acceso (si estÃ¡ en false, no puede hacer login)
 */
model User {
  // â”€â”€â”€ Campos estÃ¡ndar de NextAuth â”€â”€â”€
  id            String          @id @default(uuid())  // ID Ãºnico del usuario
  name          String?                               // Nombre (opcional, puede venir de OAuth)
  email         String          @unique               // Email (Ãºnico en la BD)
  password      String?                               // Password hasheado (solo para credenciales)
  emailVerified DateTime?                             // Fecha de verificaciÃ³n de email (OAuth)
  image         String?                               // URL de avatar (usualmente de OAuth)
  
  // â”€â”€â”€ Campos personalizados â”€â”€â”€
  roles         String[]        @default(["user"])    // Roles del usuario (para autorizaciÃ³n)
  isActive      Boolean         @default(true)        // Usuario activo/inactivo
  
  // â”€â”€â”€ Relaciones con otras tablas â”€â”€â”€
  accounts      Account[]                             // Cuentas OAuth vinculadas (Google, GitHub, etc)
  sessions      Session[]                             // Sesiones activas del usuario
  Authenticator Authenticator[]                       // Credenciales WebAuthn (passkeys, biometrÃ­a)
  todos         Todo[]                                // Todos creados por el usuario
  
  // â”€â”€â”€ Timestamps â”€â”€â”€
  createdAt DateTime @default(now())      // Fecha de registro
  updatedAt DateTime @updatedAt           // Ãšltima actualizaciÃ³n (auto)
}

/**
 * ğŸ”— MODELO ACCOUNT
 * 
 * Guarda las conexiones OAuth de cada usuario (Google, GitHub, etc).
 * Un usuario puede tener mÃºltiples cuentas vinculadas.
 * 
 * EJEMPLO:
 * Si un usuario hace login con Google Y GitHub, tendrÃ¡ 2 registros Account:
 * - Account 1: provider = "google", userId = "123"
 * - Account 2: provider = "github", userId = "123"
 * 
 * CAMPOS IMPORTANTES:
 * - provider: Nombre del proveedor OAuth (google, github, facebook, etc)
 * - providerAccountId: ID del usuario en ese proveedor (ej: Google User ID)
 * - access_token: Token para hacer requests a la API del proveedor
 * - refresh_token: Token para renovar el access_token cuando expire
 */
model Account {
  userId            String   // ID del usuario dueÃ±o de esta cuenta
  type              String   // Tipo de cuenta (usualmente "oauth")
  provider          String   // Proveedor: "google", "github", etc
  providerAccountId String   // ID del usuario en el proveedor (ej: Google ID)
  
  // â”€â”€â”€ Tokens OAuth â”€â”€â”€
  refresh_token     String?  // Token para refrescar el access_token
  access_token      String?  // Token de acceso a la API del proveedor
  expires_at        Int?     // Timestamp de expiraciÃ³n del access_token
  token_type        String?  // Tipo de token (usualmente "Bearer")
  scope             String?  // Permisos otorgados (ej: "read:user,user:email")
  id_token          String?  // ID token JWT (contiene info del usuario)
  session_state     String?  // Estado de sesiÃ³n (para OAuth 2.0)

  // â”€â”€â”€ Timestamps â”€â”€â”€
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // â”€â”€â”€ RelaciÃ³n con User â”€â”€â”€
  // Cuando se elimina el usuario, se eliminan todas sus cuentas (Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // â”€â”€â”€ Clave primaria compuesta â”€â”€â”€
  // Un usuario solo puede tener UNA cuenta por proveedor
  // Ej: No puedes vincular 2 cuentas de Google al mismo usuario
  @@id([provider, providerAccountId])
}

/**
 * ğŸ« MODELO SESSION
 * 
 * Guarda las sesiones activas cuando usas "database" strategy.
 * Si usas "jwt" strategy (recomendado), esta tabla NO se usa.
 * 
 * NOTA: En tu configuraciÃ³n usas strategy: "jwt", asÃ­ que NextAuth
 * NO crearÃ¡ registros aquÃ­. La sesiÃ³n se guarda en el JWT token.
 * 
 * Esta tabla existe por si en el futuro cambias a database sessions.
 * 
 * Â¿CuÃ¡ndo usar database sessions?
 * - Cuando necesitas revocar sesiones remotamente
 * - Para auditorÃ­a de sesiones activas
 * - Para limitar sesiones concurrentes por usuario
 */
model Session {
  sessionToken String   @unique      // Token Ãºnico de la sesiÃ³n
  userId       String                // ID del usuario de esta sesiÃ³n
  expires      DateTime              // Fecha de expiraciÃ³n
  
  // â”€â”€â”€ RelaciÃ³n con User â”€â”€â”€
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/**
 * âœ‰ï¸ MODELO VERIFICATION TOKEN
 * 
 * Guarda tokens temporales para:
 * - VerificaciÃ³n de email
 * - Magic links (login sin password)
 * - Reseteo de contraseÃ±a
 * 
 * FLUJO TÃPICO:
 * 1. Usuario solicita verificar email
 * 2. Se crea un VerificationToken con expires = now() + 24h
 * 3. Se envÃ­a email con link que contiene el token
 * 4. Usuario hace click, el token se valida y elimina
 * 
 * CAMPOS:
 * - identifier: Usualmente el email del usuario
 * - token: String aleatorio Ãºnico
 * - expires: Fecha de expiraciÃ³n
 */
model VerificationToken {
  identifier String   // Email u otro identificador del usuario
  token      String   // Token Ãºnico (generado aleatoriamente)
  expires    DateTime // Fecha de expiraciÃ³n

  // â”€â”€â”€ Clave primaria compuesta â”€â”€â”€
  // Un usuario puede tener mÃºltiples tokens (ej: uno para email, otro para reset)
  @@id([identifier, token])
}

/**
 * ğŸ” MODELO AUTHENTICATOR (WEBAUTHN)
 * 
 * Soporte para autenticaciÃ³n sin contraseÃ±a usando WebAuthn.
 * Permite login con:
 * - Huella dactilar
 * - Face ID / Touch ID
 * - Llaves de seguridad fÃ­sicas (YubiKey)
 * - Passkeys (guardadas en el navegador o iCloud)
 * 
 * CAMPOS TÃ‰CNICOS DE WEBAUTHN:
 * - credentialID: ID Ãºnico de la credencial
 * - credentialPublicKey: Clave pÃºblica para verificar firmas
 * - counter: Contador de usos (previene replay attacks)
 * - credentialDeviceType: "singleDevice" o "multiDevice"
 * - credentialBackedUp: Â¿La credencial estÃ¡ respaldada? (iCloud, etc)
 * - transports: CÃ³mo se comunica el dispositivo (usb, nfc, ble, internal)
 * 
 * EJEMPLO DE USO:
 * Usuario registra su iPhone con Face ID â†’ se crea un Authenticator.
 * PrÃ³ximo login: usa Face ID en vez de password.
 * 
 * âš ï¸ OPCIONAL: Solo necesario si implementas WebAuthn/Passkeys
 */
model Authenticator {
  credentialID         String  @unique  // ID de la credencial WebAuthn
  userId               String            // Usuario dueÃ±o de esta credencial
  providerAccountId    String            // ID de la cuenta del proveedor
  credentialPublicKey  String            // Clave pÃºblica (para verificaciÃ³n)
  counter              Int               // Contador anti-replay
  credentialDeviceType String            // Tipo: "single-device" o "multi-device"
  credentialBackedUp   Boolean           // Â¿Respaldada en la nube?
  transports           String?           // Transportes: "usb,nfc,ble,internal"

  // â”€â”€â”€ RelaciÃ³n con User â”€â”€â”€
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // â”€â”€â”€ Clave primaria compuesta â”€â”€â”€
  @@id([userId, credentialID])
}
/* ```

---

## ğŸ“Š Diagrama de Relaciones
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RELACIONES                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    USER     â”‚ â—„â”€â”€â”€ Tabla principal
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚         â”‚         â”‚         â”‚             â”‚
      â–¼         â–¼         â–¼         â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Account â”‚ â”‚Session â”‚ â”‚ Todo â”‚ â”‚Verif.    â”‚ â”‚Authenticator â”‚
â”‚ (OAuth) â”‚ â”‚ (JWT)  â”‚ â”‚      â”‚ â”‚Token     â”‚ â”‚  (WebAuthn)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CARDINALIDAD:
- 1 User â†’ N Accounts (puede vincular Google + GitHub + etc)
- 1 User â†’ N Sessions (puede tener mÃºltiples dispositivos logueados)
- 1 User â†’ N Todos (puede crear mÃºltiples tareas)
- 1 User â†’ N Authenticators (puede registrar iPhone + Mac + YubiKey) 

*/